function disabled_block(){$("#tone-block").attr("disabled","disabled"),$("#tone-block-type").attr("disabled","disabled"),$("#instrument-block").attr("disabled","disabled"),$("#instrument-block-type").attr("disabled","disabled")}function disabled_block_false(){$("#tone-block").attr("disabled",!1),$("#tone-block-type").attr("disabled",!1),$("#instrument-block").attr("disabled",!1),$("#instrument-block-type").attr("disabled",!1)}function updata_num(e){for(i=e;i<=tables_num;i++)$("#app").children(".block-table").eq(i-1).attr("id","block-table"+i),$("#app").children(".block-table").eq(i-1).children("p").text(i)}function copyToClipboard(e){var l=document.createElement("textarea");document.body.appendChild(l),l.value=e,l.select(),document.execCommand("copy"),document.body.removeChild(l)}function add_block(e,l){tables_num+=1,null==e&&(e=tables_num),null==l&&(l=[0,0,0,0]),blocks.splice(e-1,0,l),e==tables_num?($("#add-block-table").before('<div class="block-table" id="block-table'+e+'" ><p>'+e+'</p><div class="blocks" block-type="instrument"><img src="images/block/icon693.png"><p>鼓 | 0</p></div><div class="blocks" block-type="tone"><img src="images/block/icon690.png"><p>低音块 | 0</p></div></div>'),$.growl.notice({title:"",message:"添加成功",size:"small"}),$("#app").animate({scrollLeft:"+=100"},0)):1==e?($("#app").children(".block-table").eq(e-1).before('<div class="block-table" id="block-table'+e+'" ><p>'+e+'</p><div class="blocks" block-type="instrument"><img src="images/block/icon693.png"><p>鼓 | 0</p></div><div class="blocks" block-type="tone"><img src="images/block/icon690.png"><p>低音块 | 0</p></div></div>'),updata_num(e-1),$.growl.notice({title:"",message:"插入成功",size:"small"})):($("#app").children(".block-table").eq(e-2).after('<div class="block-table" id="block-table'+e+'" ><p>'+e+'</p><div class="blocks" block-type="instrument"><img src="images/block/icon693.png"><p>鼓 | 0</p></div><div class="blocks" block-type="tone"><img src="images/block/icon690.png"><p>低音块 | 0</p></div></div>'),updata_num(e-1),$.growl.notice({title:"",message:"插入成功",size:"small"}))}function block_select(e){for(disabled_block_false(),""!=selected_block&&($(selected_block).css("transition","all 0.3s ease-in-out"),$(selected_block).css("box-shadow","none")),selected_block=e,$(e).css("transition","all 0.3s ease-in-out"),$(e).css("box-shadow","0 0 12px #ffeb3b"),selected_block_id=parseInt($(e).children("p").text()),$("#tone-block").val(tone_block_list[blocks[selected_block_id-1][0]]),$("#tone-block-type").val(blocks[selected_block_id-1][1]),$("#instrument-block").val(instrument_block_list[blocks[selected_block_id-1][2]]),$("#instrument-block-type").empty(),i=0;i<8;i++)$("#instrument-block-type").append("<option>"+instrument_block_type_list[blocks[selected_block_id-1][2]][i]+"</option>");$("#instrument-block-type").val(instrument_block_type_list[blocks[selected_block_id-1][2]][blocks[selected_block_id-1][3]]),-1==blocks[selected_block_id-1][4]&&disabled_block()}tone_block="低音块",tone_block_type="0",instrument_block="鼓",instrument_block_type="底鼓",tone_block_list=["低音块","中音块","高音块"],instrument_block_list=["鼓","电子","综合"],instrument_block_type_list=[["底鼓","嗵鼓（一、二）","嗵鼓（三）","军鼓","踩镲","强音镲","节奏镲","非洲鼓（木鱼）"],["利物浦（贝斯）","合成器（chord）","电风琴","合成器（pluck音色）","管风琴","八音盒","簧风琴","电吉他"],["低音钢琴","金属吉他","空灵节奏～合成背景音","弦乐断奏～提琴类音色","鼓吹唢呐","长笛、单簧管等","柳琴、颤音琴等","钟琴、班卓琴等"]],icon_path=[["images/block/icon690.png","images/block/icon691.png","images/block/icon692.png"],["images/block/icon693.png","images/block/icon694.png","images/block/icon695.png"]],tables_num=0,blocks=[],selected_block="",selected_block_id=0,script="",music_script1='Player:notifyGameInfo2Self(0,"点击任意方块开始生成音乐")Player:notifyGameInfo2Self(0,"生成起点为房主坐标")MusicBlock={bass=690,alto=691,high=692,drum=693,elec=694,synt=695,defaultBlock=667,rhythm=',music_script2=',nowBlockPos={x=0,y=0,z=0}}function MusicBlock:create(music)local a,b=Actor:getFaceYaw(0)local c=""if b>-45 and b<=45 then c="Z-"elseif b>45 and b<=135 then c="X-"elseif b>135 and b<=180 or b<=-135 and b>-180 then c="Z+"elseif b<=-45 and b>-135 then c="X+"else c="X+"end;local function d(e)if c=="Z-"then self.nowBlockPos.z=self.nowBlockPos.z-1 elseif c=="X-"then self.nowBlockPos.x=self.nowBlockPos.x-1 elseif c=="X+"then self.nowBlockPos.x=self.nowBlockPos.x+1 elseif c=="Z+"then self.nowBlockPos.z=self.nowBlockPos.z+1 end end;local a,f,g,h=Actor:getPosition(0)self.nowBlockPos={x=f,y=g,z=h}local i=self.nowBlockPos;for j,k in pairs(music)do i=self.nowBlockPos;if c=="X+"then Block:setBlockAll(i.x,i.y,i.z,702,self.rhythm*4)elseif c=="Z+"then Block:setBlockAll(i.x,i.y,i.z,702,self.rhythm*4+2)elseif c=="Z-"then Block:setBlockAll(i.x,i.y,i.z,702,self.rhythm*4+3)elseif c=="X-"then Block:setBlockAll(i.x,i.y,i.z,702,self.rhythm*4+1)end;d()if music[5]~=-1 then if k[1]==0 then Block:setBlockAll(i.x,i.y,i.z,self.bass,k[2])elseif k[1]==1 then Block:setBlockAll(i.x,i.y,i.z,self.alto,k[2])elseif k[1]==2 then Block:setBlockAll(i.x,i.y,i.z,self.high,k[2])end;if k[3]==0 then Block:setBlockAll(i.x,i.y+1,i.z,self.drum,k[4])elseif k[3]==1 then Block:setBlockAll(i.x,i.y+1,i.z,self.elec,k[4])elseif k[3]==2 then Block:setBlockAll(i.x,i.y+1,i.z,self.synt,k[4])else error("DataError! at "..j)end else Block:replaceBlock(self.defaultBlock,i.x,i.y,i.z,0)end;d()threadpool:wait(0.01)Player:setPosition(0,i.x,i.y,i.z)end;Player:setPosition(0,f,g,h)Player:notifyGameInfo2Self(0,"#G音乐生成完成！")end;HasCreated=false;function CreateMusic(l)if HasCreated~=true then HasCreated=true;MusicBlock:create(music)else Player:notifyGameInfo2Self(0,"#R音乐已经生成过了！")end end;ScriptSupportEvent:registerEvent([=[Player.ClickBlock]=],CreateMusic)',disabled_block(),$("#tone-block").change((function(){for(i in tone_block=$(this).val(),tone_block_list)if(tone_block==tone_block_list[i]){blocks[selected_block_id-1][0]=parseInt(i),$("#block-table"+selected_block_id).children("div:last").children("p").text(tone_block+" | "+blocks[selected_block_id-1][1]),$("#block-table"+selected_block_id).children("div:last").children("img").attr("src",icon_path[0][i]);break}})),$("#tone-block-type").change((function(){tone_block_type=$(this).val(),blocks[selected_block_id-1][1]=parseInt(tone_block_type),$("#block-table"+selected_block_id).children("div:last").children("p").text(tone_block_list[blocks[selected_block_id-1][0]]+" | "+tone_block_type),$("#block-table"+selected_block_id).children("div:last").children("img").attr("src",icon_path[0][blocks[selected_block_id-1][0]])})),$("#instrument-block").change((function(){for(i in instrument_block=$(this).val(),instrument_block_list)if(instrument_block==instrument_block_list[i]){for(blocks[selected_block_id-1][2]=parseInt(i),$("#instrument-block-type").empty(),j=0;j<8;j++)$("#instrument-block-type").append("<option>"+instrument_block_type_list[blocks[selected_block_id-1][2]][j]+"</option>");$("#instrument-block-type").val(instrument_block_type_list[blocks[selected_block_id-1][2]][blocks[selected_block_id-1][3]]),$("#block-table"+selected_block_id).children("div:first").children("p").text(instrument_block+" | "+instrument_block_type_list[i][blocks[selected_block_id-1][3]]),$("#block-table"+selected_block_id).children("div:first").children("img").attr("src",icon_path[1][i]);break}})),$("#instrument-block-type").change((function(){for(instrument_block_type=$(this).val(),i=0;i<8;i++)instrument_block_type==instrument_block_type_list[blocks[selected_block_id-1][2]][i]&&(blocks[selected_block_id-1][3]=parseInt(i),$("#block-table"+selected_block_id).children("div:first").children("p").text(instrument_block_list[blocks[selected_block_id-1][2]]+" | "+instrument_block_type),$("#block-table"+selected_block_id).children("div:first").children("img").attr("src",icon_path[1][blocks[selected_block_id-1][2]]))})),$("#delete-block").click((function(){""!=selected_block?(blocks.splice(selected_block_id-1,1),tables_num>1?($(selected_block).remove(),updata_num(selected_block_id-1),selected_block_id==tables_num?block_select($("#app").children(".block-table").eq(selected_block_id-2)):1==selected_block_id?block_select($("#app").children(".block-table").eq(0)):block_select($("#app").children(".block-table").eq(selected_block_id-1)),tables_num-=1,$.growl.notice({title:"",message:"删除成功",size:"small"})):($(selected_block).remove(),disabled_block(),tables_num-=1,selected_block="",selected_block_id=0)):$.growl.warning({title:"",message:"你还未选中方块！",size:"medium"})})),$("#insert-block").click((function(){0!=selected_block_id?(add_block(selected_block_id),block_select($("#app").children(".block-table").eq(selected_block_id))):$.growl.warning({title:"",message:"你还未选中方块！",size:"medium"})})),$("#cancel-block").click((function(){0!=selected_block_id?-1==blocks[selected_block_id-1][4]?$.growl.warning({title:"",message:"此方块已经取消过了！",size:"medium"}):(blocks[selected_block_id-1][4]=-1,$("#block-table"+selected_block_id).children("div:last").children("img").attr("src","images/block/icon667.png"),$("#block-table"+selected_block_id).children("div:first").children("img").attr("src","images/block/icon667.png"),disabled_block(),$.growl.notice({title:"",message:"取消成功",size:"small"})):$.growl.warning({title:"",message:"你还未选中方块！",size:"medium"})})),$("#recover-block").click((function(){0!=selected_block_id?-1!=blocks[selected_block_id-1][4]?$.growl.warning({title:"",message:"此方块未被取消！",size:"medium"}):(blocks[selected_block_id-1].pop(),$("#block-table"+selected_block_id).children("div:last").children("img").attr("src",icon_path[0][blocks[selected_block_id-1][0]]),$("#block-table"+selected_block_id).children("div:first").children("img").attr("src",icon_path[1][blocks[selected_block_id-1][2]]),disabled_block_false(),$.growl.notice({title:"",message:"恢复成功",size:"small"})):$.growl.warning({title:"",message:"你还未选中方块！",size:"medium"})})),$("#create-script").click((function(){0==tables_num?$.growl.warning({title:"",message:"你还未编辑音乐！",size:"medium"}):(rhythm=$("#rhythm").val(),script="music = "+JSON.stringify(blocks).replaceAll("[","{").replaceAll("]","}")+music_script1+rhythm+music_script2,$("#code").text(script),Prism.highlightAll(!0,null),$.growl.notice({title:"",message:"脚本生成成功！",size:"medium"}))})),$("#copy-script").click((function(){""==script?$.growl.warning({title:"",message:"你还未生成脚本！",size:"medium"}):(copyToClipboard(script),$.growl.notice({title:"",message:"脚本复制成功！",size:"medium"}))})),$("#add-block").click((function(){add_block()})),$("#app").on("click",".block-table",(function(){block_select(this)}));